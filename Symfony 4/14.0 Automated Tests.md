## Automated Tests

### Unit tests with PHPUnit
https://symfony.com/doc/4.0/testing.html#unit-tests

### How to run test

#### Run all tests of the application
`./bin/phpunit`

#### Run all tests in the Util/ directory
`./bin/phpunit tests/Util`

#### Run tests for the Calculator class
`./bin/phpunit tests/Util/CalculatorTest.php`

### which method names are used to share test setup code?
`setUp()` and `tearDown()`

### How to disable constructor when mocking an object?
`$this->getMockBuilder('My\Class')->disableOriginalConstructor()->getMock()`
#### using Mockery

### Where `phpunit.xml.dist` located?
in the root of your Symfony application.


### Which Symfony class offers method to test commands?
https://symfony.com/doc/4.0/console.html#testing-commands

### Using PHPUnit, which method allows to specify a mock response on second call?
`$mock->expects($this->at(1)`

### Using PHPUnit, which method allows you to expect an exception to be thrown?
`$this->expectedException('MyException')`

### base component required to write functional test
`composer require --dev symfony/browser-kit`
`composer require --dev symfony/css-selector`

### functional tests location directory
`tests/Controller`

### functional tests namespace
`App\Tests\Controller`

### Example functional tests
```php
// tests/Controller/PostControllerTest.php
namespace App\Tests\Controller;

use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class PostControllerTest extends WebTestCase
{
    public function testShowPost()
    {
        $client = static::createClient();

        $crawler = $client->request('GET', '/post/hello-world');

        $this->assertEquals(200, $client->getResponse()->getStatusCode());
    }
}
```

### Base class for functional tests
`WebTestCase`
```php
abstract class WebTestCase extends KernelTestCase
{
    /**
     * Creates a Client.
     *
     * @param array $options An array of options to pass to the createKernel method
     * @param array $server  An array of server parameters
     *
     * @return Client A Client instance
     */
    protected static function createClient(array $options = [], array $server = [])
    {
```

### $options supports
environment and debug


### Client object
The test client simulates an HTTP client like a browser and makes requests into your Symfony application
```php
$crawler = $client->request('GET', '/post/hello-world');
```

```php

namespace Symfony\Component\BrowserKit;


/**
 * Client simulates a browser.
 *
 * To make the actual request, you need to implement the doRequest() method.
 *
 * If you want to be able to run requests in their own process (insulated flag),
 * you need to also implement the getScript() method.
 */
abstract class Client
{
    protected $insulated = false;
    protected $followRedirects = true;
    protected $followMetaRefresh = false;

    private $maxRedirects = -1;
    private $redirectCount = 0;
    private $redirects = [];
    private $isMainRequest = true;

    /**
     * @param array     $server    The server parameters (equivalent of $_SERVER)
     * @param History   $history   A History instance to store the browser history
     * @param CookieJar $cookieJar A CookieJar instance to store the cookies
     */
    public function __construct(array $server = [], History $history = null, CookieJar $cookieJar = null)
    {
    }
    
    /**
     * Follow redirects?
     *
     * @return Crawler
     *
     * @throws \LogicException If request was not a redirect
     */
    public function followRedirect()
    {
        
    }

    /**
     * Sets whether to automatically follow redirects or not.
     *
     * @param bool $followRedirect Whether to follow redirects
     */
    public function followRedirects($followRedirect = true): void
    {
    }
    
   /**
     * Returns whether client automatically follows redirects or not.
     *
     * @return bool
     */
    public function isFollowingRedirects()
    {
    }

    /**
     * Sets whether to automatically follow meta refresh redirects or not.
     */
    public function followMetaRefresh(bool $followMetaRefresh = true)
    {
    }

    /**
     * Sets the maximum number of redirects that crawler can follow.
     *
     * @param int $maxRedirects
     */
    public function setMaxRedirects($maxRedirects)
    {
    }

    /**
     * Returns the maximum number of redirects that crawler can follow.
     *
     * @return int
     */
    public function getMaxRedirects()
    {
    }

    /**
     * Sets the insulated flag.
     *
     * @param bool $insulated Whether to insulate the requests or not
     *
     * @throws \RuntimeException When Symfony Process Component is not installed
     */
    public function insulate($insulated = true)
    {
    }

    /**
     * Sets server parameters.
     *
     * @param array $server An array of server parameters
     */
    public function setServerParameters(array $server)
    {
       
    }

    /**
     * Sets single server parameter.
     *
     * @param string $key   A key of the parameter
     * @param string $value A value of the parameter
     */
    public function setServerParameter($key, $value)
    {
    }

    /**
     * Gets single server parameter for specified key.
     *
     * @param string $key     A key of the parameter to get
     * @param string $default A default value when key is undefined
     *
     * @return string A value of the parameter
     */
    public function getServerParameter($key, $default = '')
    {
    }

    public function xmlHttpRequest(string $method, string $uri, array $parameters = [], array $files = [], array $server = [], string $content = null, bool $changeHistory = true): Crawler
    {
        
    }

    /**
     * Returns the History instance.
     *
     * @return History A History instance
     */
    public function getHistory()
    {
    }

    /**
     * Returns the CookieJar instance.
     *
     * @return CookieJar A CookieJar instance
     */
    public function getCookieJar()
    {
    }

    /**
     * Returns the current Crawler instance.
     *
     * @return Crawler A Crawler instance
     */
    public function getCrawler()
    {
        
    }

    /**
     * Returns the current BrowserKit Response instance.
     *
     * @return Response A BrowserKit Response instance
     */
    public function getInternalResponse()
    {
    }

    /**
     * Returns the current origin response instance.
     *
     * The origin response is the response instance that is returned
     * by the code that handles requests.
     *
     * @return object A response instance
     *
     * @see doRequest()
     */
    public function getResponse()
    {
    }

    /**
     * Returns the current BrowserKit Request instance.
     *
     * @return Request A BrowserKit Request instance
     */
    public function getInternalRequest()
    {
    }

    /**
     * Returns the current origin Request instance.
     *
     * The origin request is the request instance that is sent
     * to the code that handles requests.
     *
     * @return object A Request instance
     *
     * @see doRequest()
     */
    public function getRequest()
    {
        
    }

    /**
     * Clicks on a given link.
     *
     * @return Crawler
     */
    public function click(Link $link)
    {
        
    }

    /**
     * Clicks the first link (or clickable image) that contains the given text.
     *
     * @param string $linkText The text of the link or the alt attribute of the clickable image
     */
    public function clickLink(string $linkText): Crawler
    {
        
    }

    /**
     * Submits a form.
     *
     * @param Form  $form             A Form instance
     * @param array $values           An array of form field values
     * @param array $serverParameters An array of server parameters
     *
     * @return Crawler
     */
    public function submit(Form $form, array $values = []/*, array $serverParameters = []*/)
    {
    }

    /**
     * Finds the first form that contains a button with the given content and
     * uses it to submit the given form field values.
     *
     * @param string $button           The text content, id, value or name of the form <button> or <input type="submit">
     * @param array  $fieldValues      Use this syntax: ['my_form[name]' => '...', 'my_form[email]' => '...']
     * @param string $method           The HTTP method used to submit the form
     * @param array  $serverParameters These values override the ones stored in $_SERVER (HTTP headers must include a HTTP_ prefix as PHP does)
     */
    public function submitForm(string $button, array $fieldValues = [], string $method = 'POST', array $serverParameters = []): Crawler
    {
    }

    /**
     * Calls a URI.
     *
     * @param string $method        The request method
     * @param string $uri           The URI to fetch
     * @param array  $parameters    The Request parameters
     * @param array  $files         The files
     * @param array  $server        The server parameters (HTTP headers are referenced with a HTTP_ prefix as PHP does)
     * @param string $content       The raw body data
     * @param bool   $changeHistory Whether to update the history or not (only used internally for back(), forward(), and reload())
     *
     * @return Crawler
     */
    public function request(string $method, string $uri, array $parameters = [], array $files = [], array $server = [], string $content = null, bool $changeHistory = true)
    {
    }

    /**
     * Makes a request in another process.
     *
     * @param object $request An origin request instance
     *
     * @return object An origin response instance
     *
     * @throws \RuntimeException When processing returns exit code
     */
    protected function doRequestInProcess($request)
    {
    }

    /**
     * Makes a request.
     *
     * @param object $request An origin request instance
     *
     * @return object An origin response instance
     */
    abstract protected function doRequest($request);

    /**
     * Returns the script to execute when the request must be insulated.
     *
     * @param object $request An origin request instance
     *
     * @throws \LogicException When this abstract class is not implemented
     */
    protected function getScript($request)
    {
        throw new \LogicException('To insulate requests, you need to override the getScript() method.');
    }

    /**
     * Filters the BrowserKit request to the origin one.
     *
     * @param Request $request The BrowserKit Request to filter
     *
     * @return object An origin request instance
     */
    protected function filterRequest(Request $request)
    {
        return $request;
    }

    /**
     * Filters the origin response to the BrowserKit one.
     *
     * @param object $response The origin response to filter
     *
     * @return Response An BrowserKit Response instance
     */
    protected function filterResponse($response)
    {
        return $response;
    }

    /**
     * Creates a crawler.
     *
     * This method returns null if the DomCrawler component is not available.
     *
     * @param string $uri     A URI
     * @param string $content Content for the crawler to use
     * @param string $type    Content type
     *
     * @return Crawler|null
     */
    protected function createCrawlerFromContent($uri, $content, $type)
    {
    }

    /**
     * Goes back in the browser history.
     *
     * @return Crawler
     */
    public function back()
    {
        
    }

    /**
     * Goes forward in the browser history.
     *
     * @return Crawler
     */
    public function forward()
    {
        do {
            $request = $this->history->forward();
        } while (\array_key_exists(serialize($request), $this->redirects));

        return $this->requestFromRequest($request, false);
    }

    /**
     * Reloads the current browser.
     *
     * @return Crawler
     */
    public function reload()
    {
        return $this->requestFromRequest($this->history->current(), false);
    }



    /**
     * Restarts the client.
     *
     * It flushes history and all cookies.
     */
    public function restart()
    {
        $this->cookieJar->clear();
        $this->history->clear();
    }

    /**
     * Takes a URI and converts it to absolute if it is not already absolute.
     *
     * @param string $uri A URI
     *
     * @return string An absolute URI
     */
    protected function getAbsoluteUri($uri)
    {
        
    }

    /**
     * Makes a request from a Request object directly.
     *
     * @param Request $request       A Request instance
     * @param bool    $changeHistory Whether to update the history or not (only used internally for back(), forward(), and reload())
     *
     * @return Crawler
     */
    protected function requestFromRequest(Request $request, $changeHistory = true)
    {
    }
}
```

### What is the parameter order in the request?
- 1. HTTP method
- 2. URL

> Hardcoding the request URLs is a best practice for functional tests

### Request method full signature
```php
request(
    $method,
    $uri,
    array $parameters = array(),
    array $files = array(),
    array $server = array(),
    $content = null,
    $changeHistory = true
)
```

### What Client Request method returns?
a Crawler instance


### Crawler object

### What is Crawler?
A Crawler instance is returned each time you make a request with the Client. It allows you to traverse HTML documents, select nodes, find links and forms.

### Where the crawler located?
`Symfony\Component\DomCrawler`

### how to apply css selector in crawler
```$crawler->filter('html:contains("Hello World")')```
it will return Nodes that match the CSS selector.

### how to apply XPath expression in crawler
```$crawler->filterXpath('h1')```
it will return Nodes that match the XPath expression.

### How to return a node by index
`$crawler->filter('html:contains("Hello World")')->eq(1)`

### How to return first node
`$crawler->filter('html:contains("Hello World")')->first()`

### How to return last node
`$crawler->filter('html:contains("Hello World")')->last()`

### How to return siblings nodes
`$crawler->filter('html:contains("Hello World")')->siblings()`

### How to return all following siblings nodes
`$crawler->filter('html:contains("Hello World")')->nextAll()`

### How to return all preceding siblings nodes
`$crawler->filter('html:contains("Hello World")')->previousAll()`

### How to return all parent nodes
`$crawler->filter('html:contains("Hello World")')->parents()`

### How to return all children nodes
`$crawler->filter('html:contains("Hello World")')->children()`

> Each of these methods returns a new `Crawler` instance

### get the number of nodes stored in a Crawler
`$crawler->filter('ul.tags > li')->count()`

### What is Profiler?
Symfony provides a powerful profiler to get detailed information about the execution of any request.

### How to install profiler
`composer require --dev symfony/profiler-pack`

https://symfony.com/doc/4.0/profiler/data_collector.html
https://symfony.com/doc/4.0/profiler/profiling_data.html
https://symfony.com/doc/4.0/profiler/matchers.html
https://symfony.com/doc/4.0/profiler/storage.html

### How to Use the Profiler in a Functional Test?
https://symfony.com/doc/4.0/testing/profiling.html


### Framework objects access
It's highly recommended that a functional test only tests the response. But under certain very rare circumstances, 
you might want to access some internal objects to write assertions. In such cases, you can access the Dependency Injection Container:

```php
// will be the same container used in your test, unless you're using
// $client->insulate() or using real HTTP requests to test your application
$container = $client->getContainer();
```

> If the information you need to check is available from the profiler, use it instead.

### Client configuration
https://symfony.com/doc/4.0/testing.html#testing-configuration


### Request and response objects introspection
### PHPUnit bridge
### Handling legacy deprecated code