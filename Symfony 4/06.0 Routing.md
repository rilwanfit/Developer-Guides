# Routing
A routing is a bidirectional system: mapping the URL to a controller and also a route back to a URL.

Here the examples about the blog post controller.

### What are the possible way for configure routes in symfony?
YAML, XML, PHP, and PHP Annotations

> PHP Annotation require `annotations` package. (sensio/framework-extra-bundle)

## Configuration using Annotation?
### What is the class used for Annotation?
```php
use Symfony\Component\Routing\Annotation\Route;
```

### How to make routes to match exact name?
This is the route to list all the blog post.
```php
/**
 * @Route("/blog", name="blog_list")
 */
public function list()
```

### Is it possible to have single quotes in the path (`'/blog'`)?
No, Double quote is important in the route.

### How to make routes with dynamic part such as $slug?
This is the route to show a single blog post with a slug.
```php
/**
 * Matches /blog/*
 *
 * @Route("/blog/{placeholder}", name="blog_show")
 */
public function show($placeholder)
{
    // e.g. at /blog/yay-routing, then $placeholder='yay-routing'
}
```
### What is the name of the dynamic part of the Url?
Placeholder

### What is the value for placeholder?
It matches any value

### Does it required to match the placeholder name and the argument of the controller action?
Yes, the wildcard/placeholder and argument names must match

### What is the attribute `name`?
- Its route internal name. 
- This can be anything as long as its unique 
- Does not have any meaning yet.
- It can be used to generate URL?

### Do we need configuration files to use annotations?
No

### Do we need any configuration files to use other way of routing?
yes. we need to create a route file inside `config` directory.
ie: routes.yaml, routes.xml, and routes.php

### How to make paginated list
The {page} wildcard can only match numbers (digits):
```php
/**
 * @Route("/blog/{page}", name="blog_list", requirements={"page"="\d+"})
 */
public function list($page)
```
ie: /blog/2, /blog/3 ...

### How to make a route that only match portion of the Url is either `en` or `fr`?
```php
/**
 * @Route("/articles/{_locale}", requirements={"_locale": "en|fr"}) 
 */
public function show($_locale)
```
### What is the difference using `=` or `:` in the requirements attribute?

### How above routes different from the route to `show` a blog post?
It has `requirements` attribute with page wildcard and it can only matches numbers

### Is it possible to give a default value for a placeholder?
Yes, Add a default value to the argument of the action
```php
/**
 * @Route("/blog/{page}", name="blog_list", requirements={"page"="\d+"})
 */
public function list($page = 1)
```

### Are there any other way of providing default value?
Yes,
```php
/**
 * @Route("/blog/{page}", defaults={"page": "1"}, name="blog_list", requirements={"page"="\d+"})
 */
 public function list($page)
```

### What happens when two routes matches the same URL?
the first route that's loaded wins

### How can I see all the routes?
```bash
bin/console debug:router
```

### How to get very specific information on a single route?
```bash
bin/console debug:router route_name
```

### if you want to test whether a URL matches a given route
```bash
bin/console router:match /blog/my-latest-post

Route "blog_show" matches
```

### Is it possible to have multiple placeholders?
Yes,
```php
/**
 * @Route("/articles/{_locale}/{year}/{slug}") 
 */
public function show($_locale, $year, $slug)
```

### Is it possible to globally configure certain routes parts?
Yes, It can be done by leveraging service container parameters.

### What are the special routing parameters?
Special parameters does not need to be defined in the controller action but its available as an argument.

|     |     |
|------| -----|
|_controller | It is used to determine which controller is executed when the route is matched.|
|_format | Used to set the request format|
|_fragment|Used to set the fragment identifier, the optional last part of a URL that starts with a # character and is used to identify a portion of a document.|
|_locale | Used to set the locale on the request.|

### How URLs with Trailing Slashes treated in UNIX convention?
1. Adding trailing slashes for directories
2. Removing them to refer to files

Symfony treat both URLs as the same URL and redirect between them but only for GET and HEAD requests.

| Route path |	If the requested URL is /foo |	If the requested URL is /foo/ |
|----------- | ----------------------------- | ------------------------------ |
|/foo	| It matches (200 status response)	 | It doesn't match (404 status response) |
|/foo/	| It makes a 301 redirect to /foo/	 | It matches (200 status response) |

### How to Configure a Redirect without a custom Controller?
it can be done 
1. by using the `RedirectController` of the FrameworkBundle
2. by creating a new controller action whose only task is to redirect

### How to redirecting using a Path (`/` to `/app`)?
```yaml
# config/routes.yaml

# load some routes - one should ultimately have the path "/app"
controllers:
    resource: ../src/Controller/
    type:     annotation
    prefix:   /app

# redirecting the homepage
homepage:
    path: /
    controller: Symfony\Bundle\FrameworkBundle\Controller\RedirectController::urlRedirectAction
    defaults:
        path: /app
        permanent: true
```
> The permanent switch tells the action to issue a 301 HTTP status code instead of the default 302 HTTP status code.

### Redirecting Using a Route (`/admin` to `new_admin`)?
```yaml
admin:
    path: /admin
    controller: Symfony\Bundle\FrameworkBundle\Controller\RedirectController::redirectAction
    defaults:
        route: new_admin
        permanent: true
        # ...and keep the original query string parameters
        keepQueryParams: true
```
### How to keep the Request Method when Redirecting?
HTTP redirections change the method of POST requests to GET (because redirecting a POST request didn't work well in old browsers).
```yaml
# redirects with the 308 status code instead of 301
route_foo:
    # ...
    controller: Symfony\Bundle\FrameworkBundle\Controller\RedirectController::redirectAction
    defaults:
        # ...
        permanent: true
        keepRequestMethod: true

# redirects with the 307 status code instead of 302
route_bar:
    # ...
    controller: Symfony\Bundle\FrameworkBundle\Controller\RedirectController::redirectAction
    defaults:
        # ...
        permanent: false
        keepRequestMethod: true
```

### What are the status code used for redirection?
301 and 302

### What is the controller value format in the route?
`CONTROLLER_CLASS::METHOD`
if your controller registered as a service, `service_name:method`

### How I can use `__invoke()`?
you can just use the fully qualified class name.

### How to generate Url in the controller?
```php
$this->generateUrl('route_name')
```

### How to generate Url with placeholder?
```php
$this->generateUrl('blog_show', ['placeholder' => 'yay-routing'])
```

### How to generate Url in the a service?
```php
use Symfony\Component\Routing\Generator\UrlGeneratorInterface;
$this->urlGenerator->generate('route_name')
```

### What happens when we pass extra placeholders that's not part of the route definition?
```php
$this->urlGenerator->generate('blog_list', ['page' => '2', 'something' => 'Some'])
``` 
extra placeholder will be added to the URI as a query string: /blog/2?something=Some

### How to generate url in Twig?
?

### How to generate Url in javascript?
?

### How to generate Url in console?
?

### How to generate absolute Url?
by default, the router will generate relative URLs (e.g. /blog)
```php
$this->generateUrl('blog_show', [], UrlGeneratorInterface::ABSOLUTE_URL)
```
This will generate `http://www.example.com/blog/my-blog-post`

### How it identifies the Host name when we generate absolute Url?
It automatically detected using the current Request object.

### Some mandatory parameters are missing ("slug") to generate a URL for route "blog_show".?
you are not passing a slug value (which is required, because it has a {slug}) wildcard in the route path.

### Translating Routes
Symfony doesn't support defining routes with different contents depending on the user language. In those cases, 
you can define multiple routes per controller, one for each supported language

### Using XML or YAML, how to declare a route for a specific domain/host?
Add a "host" attribute

### How to Match a Route Based on the Host?
```php
/**
 * @Route("/", name="mobile_homepage", host="m.example.com")
 */
 /**
  * @Route("/", name="homepage")
  */
```
if the host `m.example.com` it will be using `mobile_homepage`.

### Is it possible to have placeholder in the hostname?
yes,
```php
/**
 * @Route("/", name="projects_homepage", host="{project_name}.example.com")
 */
```

#### How to provide a default value?
```php
/**
 * @Route("/", name="projects_homepage", host="{subdomain}.example.com", defaults={"subdomain"="m"})
 */
```

#### How to provide hostname options?
```php
/**
* @Route("/", name="projects_homepage", host="{subdomain}.example.com", requirements={"subdomain"="m|mobile"}) 
*/
```
### How to use service parameter in the route?
```php
/**
* @Route("/", name="projects_homepage", host="m.{domain}", defaults={"domain"="%domain%"}, requirements={"domain"="%domain%"}) 
*/
```

### What is Imported Routes?


### Using Host Matching of Imported Routes?
```php
/**
 * @Route(host="hello.example.com")
 */
class MainController extends AbstractController
```
The host hello.example.com will be set on each route loaded from the new routing resource.

### How to Restrict Route Matching through Conditions?
use the `conditions` routing option
```php
/**
 * @Route(
 *     "/contact",
 *     name="contact",
 *     condition="context.getMethod() in ['GET', 'HEAD'] and request.headers.get('User-Agent') matches '/firefox/i'"
 * )
 *
 * expressions can also include config parameters
 * condition: "request.headers.get('User-Agent') matches '%app.allowed_browsers%'"
 */
```

The condition is an expression, and you can learn more about its syntax here: The Expression Syntax. With this, the route won't match unless the HTTP method is either GET or HEAD and if the User-Agent header matches firefox.

You can do any complex logic you need in the expression by leveraging two variables that are passed into the expression:

context
An instance of RequestContext, which holds the most fundamental information about the route being matched.
request
The Symfony Request object (see Request).

> Conditions are not taken into account when generating a URL.

### Expressions are Compiled to PHP?
```php
if (rtrim($pathInfo, '/contact') === '' && (
    in_array($context->getMethod(), [0 => "GET", 1 => "HEAD"])
    && preg_match("/firefox/i", $request->headers->get("User-Agent"))
)) {
    // ...
}
```

### How to Set the Request Parameters?
```Symfony/Component/Routing/RequestContext``` provides information about the current request.

 You can define all parameters of an HTTP request with this class via its constructor
```php
public function __construct(
    $baseUrl = '',
    $method = 'GET',
    $host = 'localhost',
    $scheme = 'http',
    $httpPort = 80,
    $httpsPort = 443,
    $path = '/',
    $queryString = ''
)
```
Normally you can pass the values from the $_SERVER variable to populate the RequestContext. But if you use the HttpFoundation component, you can use its Request class to feed the RequestContext in a shortcut:

```php
use Symfony\Component\HttpFoundation\Request;

$context = new RequestContext();
$context->fromRequest(Request::createFromGlobals());
```

### How to Add HTTP Method Requirements?
Suppose you create an API for your blog and you have 2 routes: One for displaying a post (on a GET or HEAD request) and one for updating a post (on a PUT request).
```php
/**
 * @Route("/api/posts/{id}", methods={"GET","HEAD"})
 */
public function show($id)
{
    // ... return a JSON response with the post
}

/**
 * @Route("/api/posts/{id}", methods="PUT")
 */
public function edit($id)
{
    // ... edit a post
}
```
> If no methods are specified, the route will match on all methods.

### Localized Routing (i18n)
```php
/**
 * @Route({
 *     "nl": "/over-ons",
 *     "en": "/about-us"
 * }, name="about_us")
 */
public function about()
```
prefix all routes with a locale.

### How to Work with the User's Locale?
The locale of the current user is stored in the request and is accessible via the Request object
```php
public function index(Request $request)
{
    $locale = $request->getLocale();
```

https://symfony.com/doc/master/translation/locale.html#the-locale-and-the-url




### How to configure route using YAML?
```yaml
# config/routes.yaml
blog_list:
    path:     /blog
    controller: App\Controller\BlogController::list

blog_show:
    path:     /blog/{slug}
    controller: App\Controller\BlogController::show
```

### How to configure route using XML?
```xml
<!-- config/routes.xml -->
<?xml version="1.0" encoding="UTF-8" ?>
<routes xmlns="http://symfony.com/schema/routing"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/routing
        http://symfony.com/schema/routing/routing-1.0.xsd">

    <route id="blog_list" controller="App\Controller\BlogController::list" path="/blog" >
        <!-- settings -->
    </route>

    <route id="blog_show" controller="App\Controller\BlogController::show" path="/blog/{slug}">
        <!-- settings -->
    </route>
</routes>
```

### How to configure route using PHP
```php
// config/routes.php
use Symfony\Component\Routing\RouteCollection;
use Symfony\Component\Routing\Route;
use App\Controller\BlogController;

$routes = new RouteCollection();
$routes->add('blog_list', new Route('/blog', [
    '_controller' => [BlogController::class, 'list']
]));
$routes->add('blog_show', new Route('/blog/{slug}', [
    '_controller' => [BlogController::class, 'show']
]));

return $routes;
```
it uses `symfony/routing` component

##### What are the possible attribute in a route?

#### What variable can be used as controller argument to get the name of the route name?
```$_route```

##### Using XML, how to ensure that a route is accessed via HTTPS?
schemes="https"

### query parameters vs placeholders?